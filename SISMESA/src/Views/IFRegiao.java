/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * IFRegiao.java
 *
 * Created on 05/05/2011, 21:40:58
 */
package Views;

import classess.Utilitario;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.swing.SwingUtilities;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author stevan t
 */
public class IFRegiao extends javax.swing.JInternalFrame {

    /** Creates new form IFRegiao */
    public IFRegiao() {
        initComponents();
//        //redimenciona o lookandFeeld de acordo com o selecionado
//        SwingUtilities.updateComponentTreeUI(this);
//        this.pack();
        PreencherJtable();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel1 = new javax.swing.JPanel();
        TFCodigo = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        TFDescricao = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        TFValor = new Componentes.DKJTFFloat();
        jLabel1 = new javax.swing.JLabel();
        BTNovo = new javax.swing.JButton();
        BTSalvar = new javax.swing.JButton();
        BTExcluir = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        TBConsulta = new javax.swing.JTable();
        TFDescConsulta = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        BT_FILTER = new javax.swing.JButton();

        setClosable(true);
        setIconifiable(true);
        setTitle("Cadastro de região");
        setMinimumSize(new java.awt.Dimension(374, 245));
        getContentPane().setLayout(null);

        jTabbedPane1.setBackground(new java.awt.Color(153, 153, 153));

        jPanel1.setLayout(null);

        TFCodigo.setEnabled(false);
        jPanel1.add(TFCodigo);
        TFCodigo.setBounds(2, 30, 40, 20);

        jLabel2.setText("Codigo");
        jPanel1.add(jLabel2);
        jLabel2.setBounds(2, 10, 33, 14);
        jPanel1.add(TFDescricao);
        TFDescricao.setBounds(51, 30, 230, 20);

        jLabel3.setText("Descrição");
        jPanel1.add(jLabel3);
        jLabel3.setBounds(50, 10, 70, 14);

        TFValor.setText("");
        jPanel1.add(TFValor);
        TFValor.setBounds(290, 30, 60, 20);

        jLabel1.setText("Valor");
        jPanel1.add(jLabel1);
        jLabel1.setBounds(290, 10, 60, 14);

        BTNovo.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Imagens/Clear-32.png"))); // NOI18N
        BTNovo.setText("Limpar");
        BTNovo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BTNovoActionPerformed(evt);
            }
        });
        jPanel1.add(BTNovo);
        BTNovo.setBounds(50, 140, 100, 30);

        BTSalvar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Imagens/save_16.png"))); // NOI18N
        BTSalvar.setText("Salvar");
        BTSalvar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BTSalvarActionPerformed(evt);
            }
        });
        jPanel1.add(BTSalvar);
        BTSalvar.setBounds(150, 140, 100, 30);

        BTExcluir.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Imagens/delete_16.png"))); // NOI18N
        BTExcluir.setText("Excluir");
        BTExcluir.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BTExcluirActionPerformed(evt);
            }
        });
        jPanel1.add(BTExcluir);
        BTExcluir.setBounds(250, 140, 100, 30);

        jTabbedPane1.addTab("Cadastrar", jPanel1);

        jPanel2.setLayout(null);

        TBConsulta.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Código", "Descrição", "Valor"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.Integer.class, java.lang.String.class, java.lang.String.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        TBConsulta.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                TBConsultaMouseClicked(evt);
            }
        });
        TBConsulta.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                TBConsultaKeyPressed(evt);
            }
        });
        jScrollPane1.setViewportView(TBConsulta);
        TBConsulta.getColumnModel().getColumn(0).setMinWidth(20);
        TBConsulta.getColumnModel().getColumn(0).setPreferredWidth(20);
        TBConsulta.getColumnModel().getColumn(1).setMinWidth(150);
        TBConsulta.getColumnModel().getColumn(1).setPreferredWidth(150);
        TBConsulta.getColumnModel().getColumn(2).setMinWidth(20);
        TBConsulta.getColumnModel().getColumn(2).setPreferredWidth(20);

        jPanel2.add(jScrollPane1);
        jScrollPane1.setBounds(2, 50, 350, 130);

        TFDescConsulta.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                TFDescConsultaKeyReleased(evt);
            }
        });
        jPanel2.add(TFDescConsulta);
        TFDescConsulta.setBounds(2, 20, 250, 20);

        jLabel4.setText("Descrição");
        jPanel2.add(jLabel4);
        jLabel4.setBounds(2, 0, 79, 14);

        BT_FILTER.setText("Limpar");
        BT_FILTER.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BT_FILTERActionPerformed(evt);
            }
        });
        BT_FILTER.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                BT_FILTERKeyPressed(evt);
            }
        });
        jPanel2.add(BT_FILTER);
        BT_FILTER.setBounds(263, 20, 90, 23);

        jTabbedPane1.addTab("Pesquisar", jPanel2);

        getContentPane().add(jTabbedPane1);
        jTabbedPane1.setBounds(2, 2, 360, 210);

        setBounds(100, 50, 374, 245);
    }// </editor-fold>//GEN-END:initComponents

    private void BTNovoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BTNovoActionPerformed
        LimpaCampos();
}//GEN-LAST:event_BTNovoActionPerformed

    private void BTSalvarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BTSalvarActionPerformed
        GravarRegiao();
        PreencherJtable();
        LimpaCampos();
}//GEN-LAST:event_BTSalvarActionPerformed

    private void BTExcluirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BTExcluirActionPerformed
        try {
            if (TFCodigo.getText().isEmpty()) {
                JOptionPane.showMessageDialog(null, "Selecione uma região!");
                return;
            } else {
                String id_regiao = TFCodigo.getText();
                ResultSet rsCaxa = FMaster.con.executeSQL("select * from dlregiao where id_regiao = '" + id_regiao + "'");
                rsCaxa.first();
                if (rsCaxa.isFirst()) {
                    rsCaxa.absolute(rsCaxa.getRow());
                    rsCaxa.deleteRow();
                    PreencherJtable();
                    LimpaCampos();
                }
                rsCaxa.close();
            }
        } catch (SQLException ex) {
            Logger.getLogger(IFProduto.class.getName()).log(Level.SEVERE, null, ex);
        }
}//GEN-LAST:event_BTExcluirActionPerformed

    private void BT_FILTERActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BT_FILTERActionPerformed
        LimpaCamposSelecao();
        PreencherJtable();
}//GEN-LAST:event_BT_FILTERActionPerformed

    private void BT_FILTERKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_BT_FILTERKeyPressed
        if (evt.getKeyCode() == evt.VK_ENTER) {
            LimpaCamposSelecao();
            PreencherJtable();
        }
}//GEN-LAST:event_BT_FILTERKeyPressed

    private void TBConsultaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_TBConsultaMouseClicked
        if (evt.getClickCount() > 1) {
            prencherHeder();
        }
    }//GEN-LAST:event_TBConsultaMouseClicked

    private void TBConsultaKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_TBConsultaKeyPressed
        if (evt.getKeyCode() == evt.VK_ENTER) {
            prencherHeder();
        }
    }//GEN-LAST:event_TBConsultaKeyPressed

    private void TFDescConsultaKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_TFDescConsultaKeyReleased
        PreencherJtable();
    }//GEN-LAST:event_TFDescConsultaKeyReleased

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton BTExcluir;
    private javax.swing.JButton BTNovo;
    private javax.swing.JButton BTSalvar;
    private javax.swing.JButton BT_FILTER;
    private javax.swing.JTable TBConsulta;
    private javax.swing.JTextField TFCodigo;
    private javax.swing.JTextField TFDescConsulta;
    private javax.swing.JTextField TFDescricao;
    private Componentes.DKJTFFloat TFValor;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTabbedPane jTabbedPane1;
    // End of variables declaration//GEN-END:variables

    private void GravarRegiao() {

        float valor = (TFValor.getText().isEmpty() ? 0 : Float.parseFloat(TFValor.getText().replace(",", ".")));

        try {
            if (TFCodigo.getText().isEmpty()) {
                ResultSet rsRegiao = FMaster.con.executeSQL("select * from dlregiao where id_regiao = 0");
                rsRegiao.first();
                rsRegiao.moveToInsertRow();
                rsRegiao.updateInt("id_regiao", Utilitario.getSequencia("dlregiao", "id_regiao"));
                rsRegiao.updateString("descricao", TFDescricao.getText().isEmpty() ? "" : TFDescricao.getText());
                rsRegiao.updateFloat("taxa_entrega", valor);
                rsRegiao.insertRow();
                rsRegiao.close();
            } else {
                ResultSet rsRegiao = FMaster.con.executeSQL("select * from dlregiao where id_regiao  = '" + TFCodigo.getText() + "'");
                rsRegiao.first();
                if (rsRegiao.isFirst()) {
                    rsRegiao.updateString("descricao", TFDescricao.getText().isEmpty() ? "" : TFDescricao.getText());
                    rsRegiao.updateFloat("taxa_entrega", valor);
                    rsRegiao.updateRow();
                }
                rsRegiao.close();
            }
            PreencherJtable();
        } catch (Exception ex) {
        }
    }

    private void PreencherJtable() {
        String sFiltro = "";
        String sDescConsulta = TFDescConsulta.getText().trim();
        if (!sDescConsulta.equals("")) {
            sFiltro = (sFiltro + (" (UPPER(CAST(ID_REGIAO AS VARCHAR))) LIKE '%" + sDescConsulta.toUpperCase() + "%' OR"
                    + " (UPPER(DESCRICAO)) LIKE '%" + sDescConsulta.toUpperCase() + "%'"));
        }
        
        DefaultTableModel modelo = (DefaultTableModel) TBConsulta.getModel();
        modelo.setNumRows(0);
        
        ResultSet rsRegiao; 
        if (sFiltro.isEmpty()) {
            rsRegiao = FMaster.con.executeSQL("select * from dlregiao");
        } else {
            rsRegiao = FMaster.con.executeSQL("select * from dlregiao where " + sFiltro);
        }
        
        try {
            rsRegiao.first();
            if (rsRegiao.isFirst()) {
                do {
                    modelo.addRow(new Object[]{rsRegiao.getInt("id_regiao"), rsRegiao.getString("descricao"), Utilitario.getFomatDecimal(rsRegiao.getFloat("taxa_entrega"))});
                } while (rsRegiao.next());
            }
            rsRegiao.close();
        } catch (SQLException ex) {
            Logger.getLogger(IFRegiao.class.getName()).log(Level.SEVERE, null, ex);
        }
    }

    private void LimpaCamposSelecao() {
        TFDescConsulta.setText("");
    }

    private void LimpaCampos() {
        TFCodigo.setText("");
        TFDescricao.setText("");
        TFValor.setText("");
    }

    private void prencherHeder() {
        String id_regiao = Utilitario.getValueColumn("Código", TBConsulta);
        if (!id_regiao.equals("0")) {
            ResultSet rsRegiao = FMaster.con.executeSQL("select * from dlregiao where id_regiao = '" + id_regiao + "'");
            try {
                rsRegiao.first();
                if (rsRegiao.isFirst()) {
                    TFCodigo.setText(String.valueOf(rsRegiao.getInt("id_regiao")));
                    TFDescricao.setText(rsRegiao.getString("descricao"));
                    TFValor.setText(Utilitario.getFomatDecimal(rsRegiao.getFloat("taxa_entrega")));
                    jTabbedPane1.setSelectedIndex(0);
                    TFDescricao.requestFocus();
                }
                rsRegiao.close();
            } catch (SQLException ex) {
                JOptionPane.showMessageDialog(null, "Problema no posicionamento da região");
            }
        }
    }
}
